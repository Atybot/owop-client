/* World of Pixels protocol:
 * 	 Clientbound = Messages sent from server to client
 *   Serverbound = Messages sent from client to server
 */

Stage LOGIN:
	Clientbound:
  	0: Login response
    	[Uint8] Response code [0 = Success, 1 = Invalid login, 2 = Slow down, login too fast on this ip or something?]
      
  Serverbound:
  	0: Login
    	[Uint8] Username length
      [ASCII] Username
      [Uint8] Password length
      [ASCII] Password
      
    1: Register
    	[Uint8] Username length
      [ASCII] Username
      [Uint8] Password length
      [ASCII] Password
      [Token] Captcha verification (We will use ReCaptcha, i have like registered or something...)
      
    2: Guest login
    	[Token] Captcha verification

Stage PLAY:
	Clientbound:
  	0: Join
    	[Uint8] World name length
    	[ASCII] World name
    	
    1: Permissions update
    	[Uint8] Rank
      [Uint32] Permissions bitfield [
      	Bit 0: Allow cursor tool,
        Bit 1: Allow move tool,
        Bit 2: Allow pipette tool,
      ],
      [Uint16] Pixel update rate limit,
      [Uint16] Chat rate limit
  		
    2: World data
    	[Int32] Chunk x
      [Int32] Chunk y
      [Chunk] Chunk data (768 bytes)
      ... (Repeat if length of msg is larger)
      
    3: World update
    	[Uint8] Number of player updates
      	[Uint32] ID of the player updated
        [Int32] Cursor x
        [Int32] Cursor y
        [Uint8] Red value
        [Uint8] Green value
        [Uint8] Blue value
        [Uint8] Tool
        ... repeat for (num of player updates)
      [Uint16] Number of pixel updates
      	[Int32] Pixel x
        [Int32] Pixel y
        [Uint8] Red value
        [Uint8] Green value
        [Uint8] Blue value
        ... repeat for (num of pixel updates)
      [Uint8] Number of players left
      	[Int32] ID of the player that left
        ... repeat for (num of players left)
    
    4: Chat message
    	[Utf-8] Chat json, {
      		"sender": {
          	"id": [Int],
            "nickname": [String]
          },
          "messageRaw": [String], // Message without style, nickname and rank effects
          "message": [
          	{
            	"text": [String],
              "bold": [Boolean],
              "italic": [Boolean],
              "color": [Hex string]
            },
            ...
          ]
      	}
  		
  Serverbound:
  	0: Request chunk
    	[Int32] Chunk x
      [Int32] Chunk y
      ... (Repeat for multiple chunks)
      
    1: Put pixel
    	[Int32] Pixel x
      [Int32] Pixel y
      [Uint8] Red value
      [Uint8] Green value
      [Uint8] Blue value
      
    2: Cursor update
    	[Int32] Cursor x (16px per world pixel)
      [Int32] Cursor y 
      [Uint8] Tool [ // It is up to the client to decide what tool every value it, doesn't matter to the server
          0: Cursor,
          1: Move,
          2: Pipette,
          3: Zoom,
          128: Fill (Chunk),
          129: Fill (Color),
          130: Kick, // Kick the clicked player, right click kick all on that ip sure
          131: Ban // (Right click bans ip, Left click bans user?)
        ],
      [Uint8] Red value
      [Uint8] Blue value
      [Uint8] Green value
      
    3: Fill chunk
    	[Int32] Chunk x
      [Int32] Chunk y
      [Uint8] Red value
      [Uint8] Green value
      [Uint8] Blue value
      
    4: Chat
			[Utf-8] Message
      
    255: Change world
    	[ASCII] World name (read until message end)